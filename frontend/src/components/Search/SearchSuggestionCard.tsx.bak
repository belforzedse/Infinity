import Image from "next/image";
import { faNum } from "@/utils/faNum";
import { FC } from "react";
import { motion } from "framer-motion";

export interface SearchSuggestionCardProps {
  id: number;
  title: string;
  price?: number;
  discountPrice?: number;
  discount?: number;
  category?: string;
  image?: string;
  isAvailable?: boolean;
  onClick: () => void;
  index: number;
  isActive?: boolean;
}

const SearchSuggestionCard: FC<SearchSuggestionCardProps> = ({
  id,
  title,
  price,
  discountPrice,
  discount,
  category,
  image,
  isAvailable = true,
  onClick,
  index,
  isActive = false,
}) => {
  const hasPrice = price !== undefined && price !== null;
  const hasDiscountPrice = discountPrice !== undefined && discountPrice !== null;
  const isDiscounted =
    hasPrice &&
    hasDiscountPrice &&
    Number(discountPrice) > 0 &&
    Number(price) > Number(discountPrice);
  const computedDiscount = isDiscounted
    ? Math.round(((Number(price) - Number(discountPrice)) / Number(price)) * 100)
    : undefined;
  const showDiscount = (discount ?? computedDiscount) && (discount ?? computedDiscount)! > 0;
  return (
    <motion.button
      type="button"
      onClick={onClick}
      className={`w-full text-right transition-colors p-3 border-b border-gray-100 last:border-b-0 ${
        isActive ? "bg-pink-50" : "hover:bg-gray-50"
      }`}
      initial={{ opacity: 0, y: 6 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.15, delay: index * 0.03 }}
      whileHover={{
        backgroundColor:
          isActive ? "rgba(252, 231, 243, 1)" : "rgba(249, 250, 251, 1)",
      }}
      whileTap={{ scale: 0.98 }}
    >
      <div className="flex items-center gap-3">
        {/* Product Image */}
        <div className="flex-shrink-0 w-12 h-12 rounded-lg overflow-hidden bg-gray-100">
          {image ?
            <Image
              src={image}
              alt={title}
              width={48}
              height={48}
              className="w-full h-full object-cover"
            />
          : <div className="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                className="text-gray-400"
              >
                <path
                  d="M21 19V5C21 3.9 20.1 3 19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19ZM8.5 13.5L11 16.51L14.5 12L19 18H5L8.5 13.5Z"
                  fill="currentColor"
                />
              </svg>
            </div>
          }
        </div>

        {/* Product Info */}
        <div className="flex-1 min-w-0">
          <div className="flex flex-col">
            {/* Category */}
            {category && (
              <span className="text-xs text-gray-500 mb-0.5 truncate">
                {category}
              </span>
            )}

            {/* Title */}
            <h4 className="text-sm font-medium text-gray-900 line-clamp-1 mb-1">
              {title}
            </h4>

            {/* Price */}
            <div className="flex items-center gap-2">
              {!isAvailable ?
                <span className="text-sm text-red-600">ناموجود</span>
              : hasPrice ?
                <div className="flex items-center gap-2">
                  {discountPrice &&
                    discountPrice > 0 &&
                    discountPrice < price && (
                      <>
                        <span className="text-sm font-medium text-pink-600">
                          {faNum(discountPrice)} تومان
                        </span>
                        <span className="text-xs text-gray-500 line-through">
                          {faNum(price)}
                        </span>
                      </>
                    )}
                  {(!discountPrice ||
                    discountPrice === 0 ||
                    discountPrice >= price) && (
                    <span className="text-sm font-medium text-gray-700">
                      {faNum(price)} تومان
                    </span>
                  )}
                </div>
              : <span className="text-sm text-gray-500">محصول</span>}
            </div>
          </div>
        </div>

        {/* Discount Badge */}
        {discount && discount > 0 && (
          <div className="flex-shrink-0">
            <div className="bg-red-500 text-white text-xs px-2 py-1 rounded-full">
              ٪{discount}
            </div>
          </div>
        )}
      </div>
    </motion.button>
  );
};

export default SearchSuggestionCard;


