---
description: Contract Schema and Contract Models
globs: 
alwaysApply: false
---
# Contract Schema

## Contract Models

The contract system consists of:

- [Contract](mdc:src/api/contract/content-types/contract/schema.json) - The main contract model
  - Defines agreements between users or between users and the platform
  - Contains contract terms, conditions, and status
  - Stores total order amount in the `Amount` field
  - Records tax percentage in the `TaxPercent` field
  
- [Contract Transaction](mdc:src/api/contract-transaction/content-types/contract-transaction/schema.json) - Transaction records for contracts
  - Records financial transactions related to contracts
  - Tracks payment history and status

## Financial Calculation

When calculating financial totals for contracts:

1. **Subtotal**: Sum of all order items (price Ã— quantity)
2. **Discount**: Applied from applicable general discounts
3. **Tax**: Calculated based on TaxPercent (default 10%) applied to (subtotal - discount)
4. **Shipping**: Added from the shipping method's price
5. **Total Amount**: (subtotal - discount + tax + shipping)

The `Amount` field in the contract stores the final total amount.

## Contract Status Flow

Contracts follow this status flow:
- **Not Ready**: Initial state when created, awaiting payment
- **Confirmed**: Payment has been confirmed
- **Finished**: Contract fulfilled
- **Failed**: Payment or processing failed
- **Cancelled**: Contract cancelled by user or system

