---
description: Order and Cart Schema and Order and Cart Models
globs: 
alwaysApply: false
---
# Order and Cart Schema

## Cart Models

The shopping cart system consists of:

- [Cart](mdc:src/api/cart/content-types/cart/schema.json) - The main cart model
  - Belongs to a user
  - Contains multiple cart items
  - Tracks cart totals and status
  
- [Cart Item](mdc:src/api/cart-item/content-types/cart-item/schema.json) - Items in a shopping cart
  - References product variations
  - Tracks quantity and price

## Order Models

The order system consists of:

- [Order](mdc:src/api/order/content-types/order/schema.json) - The main order model
  - Created when a cart is checked out
  - Contains order metadata, shipping, and payment information
  - Tracks order status and history
  - Has `ShippingCost` field for shipping fee
  - Links to a contract for financial details
  
- [Order Item](mdc:src/api/order-item/content-types/order-item/schema.json) - Items within an order
  - References product variations
  - Tracks quantity, price, and status

## Shipping and Payment

- [Shipping](mdc:src/api/shipping/content-types/shipping/schema.json) - Shipping method options
  - Contains shipping rates, methods, and delivery options
  
- [Shipping Province](mdc:src/api/shipping-province/content-types/shipping-province/schema.json) - Province/state data for shipping
  
- [Shipping City](mdc:src/api/shipping-city/content-types/shipping-city/schema.json) - City data for shipping
  
- [Payment Gateway](mdc:src/api/payment-gateway/content-types/payment-gateway/schema.json) - Payment processing options
  - Defines available payment methods and gateways

## Checkout Flow

When finalizing a cart to an order:

1. Cart items are validated for stock availability
2. An order is created with shipping details
3. Order items are created from cart items
4. Product stock is adjusted
5. Stock logs are created for inventory tracking
6. A contract is created with all financial details
7. The cart is cleared (status set to "Empty")
8. Payment is initiated through payment gateway

Financial calculations (subtotal, discount, tax, shipping) are performed during checkout but stored in the contract, not in the order itself.

