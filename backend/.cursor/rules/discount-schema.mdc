---
description: Discount Schema and Discount Models
globs: 
alwaysApply: false
---
# Discount Schema

## Discount Models

The discount system consists of:

- [Discount](mdc:src/api/discount/content-types/discount/schema.json) - The main discount model
  - Contains discount code, type, and value
  - Defines validity period and usage limits
  - Can be applied to specific products or categories
  
- [General Discount](mdc:src/api/general-discount/content-types/general-discount/schema.json) - Store-wide discount campaigns
  - Contains general promotions that apply site-wide
  - Defines discount rules, duration, and eligibility criteria

## Discount Application Rules

During checkout, discounts are applied in this order:

1. **General Discounts**: Applied first if the order subtotal meets the minimum amount requirement
   - Only one general discount is applied (highest priority or first found)
   - Can be percentage-based (with optional maximum cap) or fixed amount

2. **Special Product Discounts**: Not currently implemented in the system

## Important Fields

For General Discounts:
- `Amount`: The discount amount (percentage or fixed value)
- `IsPercentage`: If true, Amount is treated as a percentage; otherwise, as a fixed amount
- `MinimumAmount`: The minimum order subtotal required to qualify for the discount
- `MaxAmount`: For percentage discounts, the maximum discount amount that can be applied
- `IsActive`: Whether the discount is currently active
- `StartDate` and `EndDate`: The validity period of the discount

## Discount Calculation

1. **Percentage Discount**: (subtotal Ã— Amount / 100)
   - Capped at MaxAmount if specified
2. **Fixed Amount Discount**: Amount

The final discounted total is (subtotal - discount amount).
